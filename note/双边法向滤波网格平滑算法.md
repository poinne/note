## 双边法向滤波网格平滑算法

[参考博客](https://blog.csdn.net/chenbb1989/article/details/122901456)

通过高斯迭代求面的法向：

![image-20240311212621521](https://raw.githubusercontent.com/poinne/md-pic/main/image-20240311212621521.png)

#### 算法流程

1. **调整面的法向**：

   利用双边滤波调整某个面片的法向

2. **更新三角形顶点坐标**：

   使更新后的三角形面的法向尽可能和调整后的面的法向一致

#### 算法实现

1. 读入带噪声的obj模型

2. 预处理相应数据用于双边滤波

   - 各个面的初始法向
   - 各个面的面积
   - 各个面的中心坐标(重心坐标)

3. 计算高斯分布中的参数sigma

   此算法中为sum(每个面的中心到领域内面的中心之和) / （面的数量 * 8）

   因为三角形网格中，每个三角形面与三个面相邻，所有当全部的三角形面的距离计算完成后，每个三角形面都被算了三遍。

4. 迭代更新面的法向

   利用双边滤波算法的公式：

   ![image-20240311212621521](https://raw.githubusercontent.com/poinne/md-pic/main/image-20240311212621521.png)

   更新面的法向。

   其中，对于公式中的第一个高斯分布，参数sigma为第三步所得的sigma。而公式中的第二个高斯分布，参数sigma为1.（补充）

5. 迭代更新顶点

   ![image-20240311213521818](https://raw.githubusercontent.com/poinne/md-pic/main/image-20240311213521818.png)

   因为面的法向和该面的各条边都垂直，将上面的方程组整理后可得能量方程：![image-20240311213617448](https://raw.githubusercontent.com/poinne/md-pic/main/image-20240311213749781.png)

   每次只移动一个点，使E最小，令该公式导数为0，可推导出：

   ![image-20240311213749781](https://raw.githubusercontent.com/poinne/md-pic/main/image-20240311213617448.png)

   即可得新点坐标。

