使用机器学习，在离散曲面网格上使用水平集函数进行控制条件下曲线的生成。

##### 1

随着计算机图形学和几何处理技术的飞速发展，如何在复杂的离散曲面上生成光滑且满足特定控制条件的曲线，成为了研究的一个重要课题。特别是在有限元（FEM）和计算机辅助设计（CAD）等应用中，光滑曲线的生成对于形状建模、物理仿真和特征提取等领域至关重要。在此背景下，三角网格（2-流形网格）作为广泛使用的几何表示方式，在几何处理和曲线设计中占据着核心地位。为了能够在这些网格上生成光滑的曲线，我们需要处理网格的不规则性和拓扑复杂性，如何有效地约束曲线形状成为了一个难点。

传统的曲线生成方法，如基于B样条的曲线插值，虽然能够在规则网格上取得良好效果，但在处理非均匀分布的网格（尤其是三角网格）时，往往存在效率低下或者精度不足的问题。为了克服这些问题，研究者们开始探索基于深度学习的曲线生成方法。深度学习模型能够有效地从大规模数据中学习到更复杂的几何和拓扑结构，并在多种复杂的几何任务中展现出了强大的潜力。



###### 离散曲面网格上的曲线生成

曲线生成是计算机图形学、计算几何学和计算机辅助设计（CAD）等领域的重要研究方向。在早期的研究中，基于**B样条**、**贝塞尔曲线**等传统方法的曲线生成被广泛应用。这些方法通过控制点和参数化定义曲线，可以保证光滑性和连续性。然而，这些方法通常假设曲线的控制点位于规则的网格结构上，因此在处理不规则、稀疏或复杂网格时，其性能往往受到限制。不同于欧式空间，水密的三角网格属于2-流形，生成的曲线需要嵌入离散曲面表面。

传统方法进行离散曲面上的曲线设计一般有两种方法，基于优化的方法和定义黎曼度量的方法。

同时曲线的表示可以分为显式表示和隐式表示。

基于优化的方法通常使用变分思想，将曲线要满足的各种约束设计为能量函数，通过用数值优化方法最小化该能量函数，来得到满足约束的曲线。

而曲线的显示表示方法，直接在网格上设计显式曲线以满足各种约束，如流形约束、插值约束和平滑度约束等等。用显式方式表如：在欧几里得空间中计算出一条偏离曲面的参数曲线，然后将结果投影回曲面。这种方式虽然简单，且可以直观地表示曲线，但欧几里得距离逼近测地距离的误差可能很大，并且将R^3空间的曲线投影到曲面上可能会产生自交，投影后的曲线可能不够光滑。

（1）An optimization-driven approach for computing geodesic paths on triangle meshes

使用L-BFGS求解器来最小化路径长度的总和，同时考虑非均匀密度和各向异性度量，以及用户指定的几何约束。但是在优化过程中需要频繁更新维护的顶点，计算成本很高。 

（2）A variational approach for feature-aware B-spline curve design on surface meshes

通过在简化的壳空间内部放松B样条曲线，并利用配备的双射映射评估其与表面的距离，结合内外部约束，使用内点法和自适应插入样条结点的方法来最小化曲线与表面的距离。

而隐式表示也叫做水平集方法（Level Set Method, LSM），能够自然处理曲线和曲面的拓扑变化。水平集方法通过定义一个标量场（通常是距离函数）来表示曲线或曲面，其优点在于能够方便的处理曲线的生成、演化以及拓扑变化，而不需要显式地维护曲线或曲面的几何表示。在离散曲面网格上使用水平集方法生成光滑曲线，可以保证曲线的连续性和光滑性，并且可以自然地将曲线限制在网格表面上（流形约束）。

（3）Versatile Curve Design by Level Set with Quadratic

首次利用水平集进行离散曲面上的曲线设计，使用变分框架，通过局部Hessian校正和信赖域策略增强的牛顿法，以接近二次收敛和几何线性复杂度进行数值求解，将平滑度、插值、切线控制等约束加入目标函数，对曲线进行几何控制。但是该方法并没有考虑曲线的连通性，对于不同的初始化方法，最终的曲线拓扑可能并不相同。同时，处理接近退化的网格会造成数值问题。

定义黎曼度量的方法。

欧式空间中，可以通过仿射加权平均得到一条样条曲线，曲线的表达式如下：

![image-20241124135053302](https://raw.githubusercontent.com/poinne/md-pic/main/image-20241124135053302.png)

扩展到非欧空间中的曲线，则通过定义黎曼质心来等价于仿射加权平均的形式。

![image-20241124135040254](https://raw.githubusercontent.com/poinne/md-pic/main/image-20241124135040254.png)

其中 $d(p,p_i)$表示两点之间的测地距离，则定义在流形上的样条曲线为：

![image-20241124135235833](https://raw.githubusercontent.com/poinne/md-pic/main/image-20241124135235833.png)

通过优化能量$K(p)$ 来计算流形上的曲线。

（4）The vector heat method

Sharp 等人（2019）提出了一种基于向量热技术的算法，用于直接在测地度量下计算黎曼质心（RCM）。使用向量热技术高效计算流形上的对数映射。但是对数映射计算开销大，在样条曲线生成中效率较低，且控制点必须位于输入网格的顶点，限制了方法的灵活性。

这种方法适用于计算单个黎曼质心，但在复杂应用（如样条曲线设计）中表现不佳。

（5）Computing the Riemannian center of mass on meshes.

Mancinelli 和 Puppo 将牛顿法推广到流形上，并用来求解 RCM 的最优点。通过使用分段线性和分段常数估计大幅减少了梯度和 Hessian 的计算成本。但是梯度和 Hessian 的低阶近似降低了精度，算法对网格质量敏感，在网格剖分不佳时容易失败。

**基于学习的方法**

基于学习的方法当前主要关注于利用模型预测离散曲面网格上给定两点之间的最优测地曲线，学习目标是使预测出的曲线尽可能贴近曲面的同时曲线的曲率处处为0。

（6）**Learning the Geodesic Embedding with Graph Neural Networks**

使用GNN学习测地曲线嵌入，来预测给定点之间的测地距离，由于使用了Unet架构，该模型可以处理含噪声或不完整的网格。对于要查询的网格，只需一次前向过程进行预计算，即可查询任意两点间的测地距离。但是无法预测点对之间的测地曲线。

（7）**GraphWalks: Efficient Shape Agnostic Geodesic Shortest Path Estimation**

同样采用 GNN 来预测两点之间的测地路径，该方法将网格视为图结构，并设计了可微的顶点预测器，以逐点预测给定点之间的测地路径，最终生成由网格边组成的测地路径，确保曲线位于曲面上。然而，由于预测的路径只能沿网格边生成，无法穿过面片，导致预测精度受到较大限制。

（8）**NeuroGF: A Neural Representation for Fast Geodesic Distance and Path Queries**

NeuroGF则是通过大量数据来训练一个过拟合的模型，通过模型提取顶点特征，来优化给定的两点之间欧式空间中的直线段。该模型对于给定两点之间的测地路径的预测精度很高。但是不能保证优化之后的曲线完全位于曲面上。且模型的泛化性能很差，每个网格都需要用大量的数据单独训练模型。

这些模型都是寻找给定点之间最优的测地路径，并没有引入额外的几何约束来对曲线进行几何控制。

这些方法主要任务是寻找点对之间的最优测地曲线，通过预测曲线和真实曲线的均方误差损失来训练模型，并没有涉及到给定形状约束下的最优曲线生成。

###### 水平集函数与机器学习结合

使用水平集方法来隐式地表示曲线曲面在很早之前就已经流行（（9）Fronts Propagating with Curvature-Dependent Speed: Algorithms Based on Hamilton-Jacobi Formulations.），随着机器学习的流行，也有很多的研究将水平集方法应用在各种机器学习常见任务中，如：

（10）Deep Level Sets for Salient Object Detection

使用水平集方法辅助进行图像分割，通过在图像上定义水平集函数来表示图像中要分割的显著物体的边缘，使最终的物体边缘连续且具体更多的细节。

（11）DevelSet: Deep Neural Level Set for Instant Mask Optimization

使用水平集函数进行掩膜优化，对输入的掩膜进行预处理，得到掩膜上的TSDF值，之后定义水平集损失来对ViT进行有监督训练。

（12）Deep Level Sets: Implicit Surface Representations for 3D Shape Inference

该模型定义了一个基于水平集函数的损失函数，来优化定义在体素上的水平集函数，将水平集函数隐式表示的曲面拟合为目标模型的表面。

上面的方法都是在规则的输入数据上定义水平集函数，然后利用真实的水平集函数的值进行有监督训练，优化模型参数，【并没有水平集函数的演化过程。】，

###### 网格卷积

相比于图像和体素数据，网格数据具有不规则性，每个网格顶点的邻域顶点数量是不固定的，不具有平移不变性，因此不能用固定的卷积核进行卷积。在欧几里得域中，网格数据的卷积通常可以分为两类。一是直接应用图卷积理论，另一种是利用网格的独特属性来定义卷积。通常后者的应用范围有限，但是效果好于前者。

应用图卷积理论的做法有两种：

基于空间域的图卷积，在欧式空间中进行卷积。

即把输入的网格看作图，使用图顶点的1环邻域近似欧几里得空间中3*3卷积核，来来扩展欧几里得空间中卷积的定义，卷积操作就是对每个顶点邻域内的顶点特征进行聚合，不同的研究主要集中在处理1环邻域内顶点数量不同的问题。

Inductive representation learning on large graphs.（13）

固定卷积核大小 k，然后从顶点的1环邻域中均匀采样 k 个顶点进行特征聚合。由于顶点邻域是无序的，因此采用对称的聚合函数（如 sum、mean、max）来实现不依赖邻域顺序的特征聚合。

（14）**Learning the Geodesic Embedding with Graph Neural Networks**

使用GNN 对顶点的1环邻域内所有顶点进行信息聚合，并在池化操作中综合考虑顶点的法向信息，以更精确地进行特征更新和聚合。这种方法更适合捕获网格几何结构中的方向性特征。

基于图谱理论的图卷积，在谱域空间中进行特征卷积。

（15）Spectral networks and locally connected networks on graphs

通过构建图的拉普拉斯矩阵并进行特征分解，利用傅里叶变换将图的数据映射到以拉普拉斯矩阵的特征向量为基的 N 维空间。在该频域空间中，卷积操作可以通过图信号的频谱表示实现，从而能够更有效地捕获图上的全局特征。

（16）Laplacian2Mesh: Laplacian-Based Mesh  Understanding

同样是基于图谱理论，但是其谱空间并不是由所有laplacian特征向量作为基底构成，而是使用前K个代表低频信息的特征值对应的特征向量组成，并且会同时使用多个k来得到不同分辨率的特征信息，以更好地学习输入网格的几何特征。（`卷积操作的不同`）



使用网格的特有属性来定义卷积，如：

 （17）**MeshCNN: a network with an edge**

以网格的边为卷积的基本单元，每条边的特征由其相邻的两个面定义。卷积操作基于每条边的四条相邻边，能够充分利用网格的局部几何信息。池化操作通过边折叠方法实现，从而逐步简化网格的分辨率，同时保留其整体几何特性。

（18）MeshNet: Mesh Neural Network for 3D Shape Representation

将面作为卷积的基本结构，将面的特征分割成空间特征和结构特征。 通过聚合邻接面的特征来扩展面的感受野，从而捕获更广泛的局部结构信息。但是 MeshNet的性能比较依赖于初始数据的精度和质量。



###### 曲线设计中的拓扑控制

拓扑控制在几何设计，尤其是曲线编辑和点云重建中一直是一个有挑战性的问题，持续同调技术可以通过持久图（PD）来跟踪拓扑结构发生改变时的关键点对，进而控制拓扑结构。

持久图将拓扑特征按照其“持久性”在不同尺度下进行编码和描述。持续同调图将不同维度的拓扑特征（如零维连通成分、环、洞等）表示为点集，每个点对应着一个拓扑特征，并记录其出生尺度和消失尺度。持久性越长的特征，表示它在数据中越重要。而持久性较短的特征则通常被认为是噪声。在重建中往往通过增加重要特征的持久性，并减少噪声特征的持久性来使重建结果尽可能与原对象拓扑一致。

（19）Topology-controllable Implicit Surface Reconstruction Based on Persistent Homology

将持续同调方法引入点云重建中，利用拓扑先验，使用持续图中的持久对，通过定义可微的拓扑逆映射来优化隐式B样条的控制系数，以控制通过隐式B样条表示的等值面的拓扑。

通过迭代逼近优化结合持续图中的特征来优化重建曲面的拓扑。

（20）SDFConnect: Neural Implicit Surface Reconstruction of a Sparse Point Cloud  with Topological Constraints

![image-20241120223023474](https://raw.githubusercontent.com/poinne/md-pic/main/image-20241120223023474.png)

在Neural-Pull框架的基础上，通过拓扑同调设计拓扑损失，来增强Neural-Pull的损失函数，通过增加重要特征的持续性并减少噪声特征的持续性来对重建进行拓扑约束。

上述方法使用稀疏的点云或采样点来计算持续图

但是，在大规模的点云或网格上有效计算持续图需要很大的计算量和内存，不能直接计算持续图用于拓扑控制。因此需要将持续图进行向量化,以便  将这些拓扑特征应用于几何处理的相关问题中。  

持续图的向量化可以分为将持续图转换为显  式向量表示和隐式向量表示 2 类方法。持续图向量 化的要点是转换得到的向量关于持续图的距离度量是稳定的,即持续图上的小扰动也对应着向量表示上的小扰动。（（21）计算机辅助拓扑设计）

（22）Persistence images: A stable vector  representation of persistent homology.

提出持久图像（PI），将持久图（PD）转换为灰度图像，然后将持久图像（PI）矢量化用于机器学习任务。

然而，获取输入数据的持续图像（PI）通常需要两个步骤：首先计算数据的持久性图（PD），然后计算从持久性图得到的持久性图像（PI）。但这个过程计算开销大，尤其是当数据量较大时，可能导致效率较低。一些研究通过构建模型来直接学习输入数据与持久图像（PI）之间的关系，来简化求持久图像（PI）的这个过程。

（23）PI-Net: A Deep Learning Approach to Extract Topological Persistence Images.

提出PI-Net模型，用于高效计算 PI 的神经网络架构，用于从输入数据中生成持久图像（PI），但是该主要应用于处理1D时间序列信号和2D图像，不能处理网格或点云数据。

（24）Learning persistent homology of 3D point clouds

提出TopologyNet，通过学习3d点云与其相应的PI之间的映射，来有效地预测输入3d点云对应的持续图像。

###### 当前研究方法的不足

对于传统的数值方法来进行离散曲面上的曲线编辑有很多的研究，但是都存在一些问题，如显式方法通常会进行投影操作，从而造成数值的不准确。而隐式方法同样会因为网格质量差导致数值不稳定。如果使用一阶的数值优化方法，收敛速度可能会很慢，而二阶的数值优化方法需要满足hessian矩阵正定，且需要计算hessian矩阵及其逆矩阵，计算复杂度很高。因此很多研究都通过各种方式来近似计算hessian矩阵，来满足收敛速度和计算复杂度的要求。

使用机器学习的方法来进行离散曲面上的曲线编辑目前的研究并不多，并且主要都集中在预测给定曲面上指定点之间的测地路径上，并没有利用额外的几何或拓扑约束来控制曲线的形状和拓扑。且泛化性不足，某些方法（如 NeuroGF）需要针对特定网格进行单独训练，这限制了模型的通用性和跨场景应用能力。以及曲线精度问题，部分方法生成的曲线局限于网格边上，无法穿过面片，这种限制降低了曲线的拟合精度。

###### 总结

对于离散曲面上进行曲线生成和编辑，传统方法在理论基础和数值优化方面具有优势，但在处理复杂曲面或拓扑变化时往往面临效率和稳定性问题。而基于机器学习的方法则展现出在大规模数据驱动任务中的潜力，但当前研究更多关注于特定的点对路径预测，缺乏对曲线整体几何和拓扑的精确控制。

未来的研究需要结合两种方法的优点：既要借助传统方法的数学基础和优化能力，又要充分发挥深度学习在处理复杂高维数据方面的潜力。

设计结合几何约束和拓扑约束的混合优化目标，使得生成的曲线不仅满足测地性，还能够控制其形状和拓扑。

开发对网格质量不敏感的鲁棒模型，提升对低质量网格的适应性。

提升模型的泛化能力，使其能够在多种类型的离散曲面上生成高质量曲线，而无需针对每个网格单独训练。

探索隐式曲线表示（如水平集方法）与机器学习的结合，利用学习模型对曲线的演化过程进行数据驱动的优化，兼顾效率和效果。

