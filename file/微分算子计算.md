According to Crane (2018), the gradient and Laplacian operators on the triangulated mesh can be discretized by incorporating the coordinates of nodes. To obtain the gradient operator, the per-face gradient of each triangular face is calculated first. Then, the gradient on each node is the area-weighted average of all its neighboring faces, and the gradient on edge (i, j) is defined as the dot product between the per-node gradient and the direction vector eij. The Laplacian operator can be discretized with Finite Element Method (FEM):

根据 Crane (2018) 的说法，三角网格上的梯度和拉普拉斯算子可以通过合并节点坐标来离散化。为了获得梯度算子，首先计算每个三角面的每个面的梯度。然后，每个节点上的梯度是其所有相邻面的面积加权平均值，边（i，j）上的梯度定义为每个节点梯度与方向向量eij之间的点积。拉普拉斯算子可以用有限元法 (FEM) 离散化：



在有限差分框架下，不同的方案，例如二阶中心差分、一阶迎风和二阶迎风格式可用于导出以下一阶或二阶导数项的差分方程：

![image-20241205100708729](https://raw.githubusercontent.com/poinne/md-pic/main/image-20241205100708729.png)







**水平集函数梯度求解**

#### 方法1 ： 使用重心对偶网格（local average region的简化形式）

`A level set formulation of geodesic curvature flow on simplicial surfaces[J/OL].TVCG 2010.`

每个三角网格都有对应的重心对偶，但是不一定有外心对偶（Voronoi图），三角形是钝角三角形时，其外心位于钝角三角形之外。

通过连接边的中心和面的重心，构造离散三角网格$M$的重心对偶网格$M'$，如下图(a)所示。三角网格$M$的每个顶点$v_i$对应一个对偶单元$C_i$，其中内部和边界的顶点对应的对偶单元如下图(b) 和 (c) 所示：

![image-20241205213048853](https://raw.githubusercontent.com/poinne/md-pic/main/image-20241205213048853.png)







**上面的部分可以不看。**

网格顶点水平集的梯度可以表示为：

![image-20241205214327147](https://raw.githubusercontent.com/poinne/md-pic/main/image-20241205214327147.png)

即：顶点一邻域三角面的梯度绝对值的加权平均，权重为三角面面积。

其中，每个三角形的水平集梯度可以用下面的方式计算：（论文2）

![image-20241205233140777](https://raw.githubusercontent.com/poinne/md-pic/main/image-20241205233140777.png)

在一个小三角形区域内，使用局部线性插值（由顶点值和分段函数梯度决定）来近似计算该区域内水平集函数的梯度。（论文2中，$\phi$不是代表水平集函数，而是定义在三角网格上的分段函数，$u$是水平集函数）。这个公式的意思是，面$\tau$的水平集梯度为面上三个顶点的水平集值与顶点分段函数的梯度的乘积之和。并且论文中提到，顶点分段函数的梯度是一个常量，可事先计算保存到顶点中。）

具体到水平集函数中，（论文1），三角形面的水平集梯度为：

![image-20241205233020643](https://raw.githubusercontent.com/poinne/md-pic/main/image-20241205233020643.png)

其中，$c_{ii,\tau},c_{ij,\tau},c_{ik,\tau}$ 分别为：

![image-20241205233513190](https://raw.githubusercontent.com/poinne/md-pic/main/image-20241205233513190.png)

![image-20241205233527191](https://raw.githubusercontent.com/poinne/md-pic/main/image-20241205233527191.png)

即三角形$\tau$内顶点对应的内角。

所以，顶点梯度的计算如果可以直接从顶点梯度绝对值的计算类比得到的话，可以定义如下：

顶点的水平集梯度为一邻域面的水平集梯度的加权和，权为面的面积。每个面的水平集梯度，根据该面上各个顶点的局部插值得到，插值公式为：

面的水平集梯度 =  $\sum$ 顶点水平集 * 顶点的分段函数梯度

顶点的分段函数梯度是一个常量，为$\frac{1}{2}cot\theta_{ij}$，其中，i为面的索引，j为面上顶点的索引，$\theta_{ij}$为面上该顶点的内角。顶点的分段函数梯度可事先计算，并保存在顶点中。

因此就得到的顶点水平集函数的梯度及其梯度的绝对值。

####  方法2：DEC的定义

离散流形上标量场拉普拉斯算子的定义是确定的：

![image-20241208095513262](https://raw.githubusercontent.com/poinne/md-pic/main/image-20241208095513262.png)

根据离散外微积分，0-形式对应于标量场（网格顶点上的标量值），可以计算其1-形式（梯度）该梯度为边的梯度，之后再根据边长加权平均得到顶点的梯度。

$$
\nabla u(i) = \frac{1}{m}\sum^m_{j=1}(u(j) - u(i)) \times norm(v(j) - v(i))
$$
通过这种方法得到的梯度可能不能满足流形约束，需要将其投影到顶点的切平面上。

![image-20241208145705629](https://raw.githubusercontent.com/poinne/md-pic/main/image-20241208145705629.png)



#### paraview

![image-20241208145752713](https://raw.githubusercontent.com/poinne/md-pic/main/image-20241208145752713.png)