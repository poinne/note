### 函数拟合

- $R^n$：n维欧式空间 ： 1D实数、2D平面、3D空间

- 在进行函数拟合时，选择的基函数空间应该具有完备性

- 傅里叶级数 ： 任何一个周期函数都可以用sin 和 cos 的线性组合表示。
- 找拟合函数的三部曲：
  - 到哪找？ 确定某个函数几何/空间
  - 找那个？ 度量哪个函数是好的 （gauss、rbf .....）
  - 怎么找？求解或优化
    - 目标一：插值  (将数据点带入方程，得到线性方程组，解方程求出方程组中的待定系数)
    - 目标二：逼近（不需要拟合曲线处处经过数据点，尽量靠近即可 $min \sum_{i=0}^n (y_i-f(x_i))^2$）,对各系数求导，得法方程（线性方程组）$Ax=b$，最小二乘法

- 拟合（Fitting）问题
  - 输入：一些数据点
  - 输出：反应这些数据规律的函数
  - Overfitting（过拟合）或 underfitting（欠拟合）

- 插值型拟合：多项式函数

  - 使用多项式函数 $f(x)=\sum_{i=0}^{n-1}\alpha_i B_i(x)$ 插值 ${P_j}$, 其中${B_i(x) = x^i}$.

  - 具体做法：先生成$n$个随机位置的点，对这$n$个点使用$n$次多项式进行插值，会得到一个线性方程组，求解该方程组即可。

- 插值型拟合：Gauss基函数

  - . 使用 Gauss 基函数的线性组合 $f(x)=b_0 + \sum_{i=1}^{n}b_i g_i(x)$  插值 $\{P_j\}$，其中
    $$
    g_i(x)=\exp\left(-\frac{(x-x_i)^2}{2\sigma^2}\right)
    $$
    即对称轴在插值点上，$i=1,\dots,n$，缺省设 $\sigma =1$ 

  - 具体做法：
    - 首先确定高斯函数中心点位置以及宽度，根据题目要求中心点位置选取x插值点的x坐标，宽度为1。
      - 根据随机生成的插值点以及中心点和宽度构造高斯基函数矩阵。
      - 通过矩阵求解来得到插值多项式的系数,然后计算拟合值。

- 逼近型拟合：最小二乘法

  - 固定幂基函数的最高次数m (m<n)，使用最小二乘法：$\min E$，其中 $E(x)=\sum_{i=0}^{n}(y_i-f(x_i))^2$ 拟合 $\{P_j\}$。

  - 具体做法：
    - 首先确定幂基函数的维度以及采样点数量，这里幂基函数最高次数为6(初始点10个)，采样点数量为100。
      - 然后构造系数矩阵 A 和常数向量 b，使用最小二乘法求出拟合系数 c。
      - 生成拟合曲线的采样点，最后绘制图像。

- 逼近型拟合：岭回归

  - 对上述最小二乘法误差函数增加 $E_1$ 正则项，参数 $\lambda$，$\min (E+\lambda E_1)$，其中 $E_1=\sum_{i=1}^n\alpha_i^2$ 

  - 具体做法：新增了一个正则化参数 $\lambda$，用来控制正则项的重要程度。对于最小二乘法的基础上，使用加权矩阵 $A^TA+\lambda I$ 代替原来的 $A^TA$，其中 $I$ 是单位矩阵。求解得到的拟合系数向量就是加入正则化项后的结果。
  - 岭回归的核心是通过在最小二乘法的基础上增加正则化项，使模型在平衡拟合效果和模型复杂度之间取得良好的平衡。

- 我的理解
  - 插值型拟合方法就是对于给定的$n$个点，假设这$n$个点之间有一条光滑且连续的曲线，这条曲线又叫做插值曲线，或插值函数，因此这个函数是会经过所有给定的点，因此这种方法的拟合程度是比较高的。但是这种方法也有缺点，缺点如下：
    - 对噪声数据敏感。因为插值函数会经过所有点，如果某些点的测量并不准确，那么插值函数就会受到影响。
    - 容易过拟合。过拟合就是过度拟合，由于选择不对或其它原因，插值函数的次数过多，导致曲线变化幅度过大。
  - 插值型拟合方法中的多项式以及高斯基函数其实就是基函数的选择不同，前者是幂函数，后者是Gauss函数，相比于幂函数，Gauss函数更容易计算求导(因为它是一个以$e$为底的指数函数)。
  - 逼近型拟合方法就是对于给定的$n$个点，找出一个拟合函数，使得该函数尽可能的靠近这些点，同时该函数应该尽可能简单。这种方法并不要求拟合函数经过所有点，只需要尽可能靠近即可(残差平方和尽可能小)。这种方法可以有效避免噪声干扰。在逼近型拟合中，可以采用多项式函数、指数函数、三角函数等多种基函数来拟合数据，通常使用最小二乘法来确定基函数的系数。
  - 岭回归方法就是在最小二乘法中增加一个正则化项，对模型参数进行限制，从而有效地缓解过拟合问题。

### 数据拟合

- $C^0$连续：两条曲线在该点处相等

- 径向基函数（英语：radial basis function，缩写为RBF）是一个取值仅依赖于到原点距离的实值函数，即 ϕ ( x ) = ϕ ( ∥ x ∥ ) ，此外，也可以按到某一中心点c的距离来定义。其中，范数一般为欧几里得距离，不过亦可使用其他距离函数。

### 参数曲线

前提：

- 二元函数的基函数构造 ： 使用张量积形式 （多元函数类型）

  - 优点：定义鉴定，多个一元基函数的乘积形式
  - 缺点：随着位数增加，基函数个数急剧增加，导致变量急剧增加（求解规模增加，求解代价大）

  - 解决方法：多元函数的神经网络表达：用一个单变量了函数f（x）（成为激活函数）的不同仿射变换来构造”基函数“：基函数数目可控

- 向量值函数（多个应变量）（$R^1 -> R^2 、R^1 -> R^3 、R^2 -> R^3、R^2 -> R^2、R^3 -> R^3$）

  - 单变量的： $f:R^1 -> R^m $,一个自变量对应多个应变量

  - 看成多个单变量函数，各个函数独立无关

  - 几何解释：

    - 一个实数$x \in R^1$映射到m维空间$R^m$的一个点，轨迹构成$R^m$的一条曲线，本质维度维1。
    - 一条曲线由一个变量参数t决定，也成为单参数曲线，参数t可看成该曲线的时间变量
    - 可灵活表达非函数型的曲线（任意曲线）

  - 低维空间之间的函数

    ![](https://raw.githubusercontent.com/poinne/md-pic/main/6.png)

- 曲线拟合问题
  - 输入：给定平面上序列点$(x_i,y_i),i=1,2,...,n$
  - 输出：一条参数曲线，拟合这些点
- 点列的参数化 （找点$(x_i,y_i)$对应的$t_i$ ，即找某一点$(x,y)$对应的t是$[0,1]$内的哪一个。（因为$t$是新引入的变量）[点的参数化对曲线拟合的影响很大，需要好的参数化]
  - unifrorm parameterization   $t_i$均匀分布在$[0,1]$
  - Chordal parameterization  $t_i$按照点之间的距离（欧式距离）,成比例分布在 $[0,1]$
  - Centripetal parameterization  在Chordal 参数化方法基础上开根号即可
  - Foley parameterization  在Chordal 参数化方法基础上加了一个关于角度的修正项
  - [从零开始几何处理：曲线拟合与参数化 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/416902631)中介绍了点列参数化的问题

### 三次样条函数

前提：

- 软木样条通过力学可推出样条的每两个压铁之间$y(x)$为三次函数，即样条曲线为分段三次函数。

- 求解思路：

  - 某段为3次多项式，由4个待定系数$y_i(x)=a_i+b_ix+c_ix^2+d_ix^3$
  - 假设由n+1个型值点（n段），则总共有4n个变量，有限，曲线要插值型值点，由n+1个约束条件，其次，假设曲线整体为$C^2$连续，则相邻两端在拼接点需要满足3个条件（$C^0$ 连续、 $C^1$ 连续、 $C^2$连续），对于n段曲线，共有n-1个拼接点，每个拼接点需要满足3个连续性条件，所以共有3(n-1)个约束条件，则由3n-3个约束条件 ， 则共有4n-2个约束条件，因此，再加2个额外条件，即可位移确定一条曲线。
  - 最终可构成关于${M_i,i=1,...,n-1}$的$(n-1) \times (n-1)$阶的线性方程组，方程组为对称的、三对角的、对角占优的，成为三弯矩方程组，方程组系数矩阵满秩，有唯一解。可用追赶法求解三弯矩方程组。

- 具体推导过程如下：

  - 上面学习的插值拟合方法得到的曲线都是全局性的，更改一个点会引起整个曲线的变化。而三次样条函数不同，假设曲线上有$n-1$个型值点，则这个曲线被分为$n$段，每段可用三次函数分别表示。这样更改一个点，只会影响该点周围的曲线，并不会影响全部曲线。
  - 为了求出整个三次样条函数，需要分别求出每段的三次函数。设第$i$段三次函数为$a_1+a_2x_1+a_3x_1^2+a_4x_1^3=y_1$,则可得线性方程组：


$$
\left\{ \begin{array}{rcl}
  a_{11}+a_{12}x_1+a_{13}x_1^2+a_{14}x_1^3=y_1\\
  a_{21}+a_{22}x_1+a_{23}x_1^2+a_{24}x_1^3=y_2\\
  a_{31}+a_{32}x_1+a_{33}x_1^2+a_{34}x_1^3=y_3\\
  ...\\
  a_{n1}+a_{n2}x_1+a_{n3}x_1^2+a_{n4}x_1^3=y_n
  
  \end{array}\right.
$$

  - 可以看出共$4n$个未知数，为了使曲线光滑连续，需要各个段的曲线再型值点除$C^2$连续，$C^2$连续需要满足约束条件：
    - 每段多项式在端点处插值 $y_i(x_i) = Q_i$  ,  $y_{i+1}(x_{i+1} = Q_{i+1})$  $i = 0,1,2,...,n$
    - 中间点一阶导连续 $y'_{i-1}(x_i - 0) = y'_i(x_i+0)$  $i = 1,2,...,n-1$
    - 中间点二阶导连续 $y''_{i-1}(x_i - 0) = y''_i(x_i+0)$  $i = 1,2,...,n-1$
  - 由于所有点必须满足插值条件，$S(x_i) = y_i (i=0,1,...,n)$，除了两个端点，所有$n-1$个内部点的每个点都满足$S_i(x_{i+1})=y_{i+1} S_{i+1}(x_{i+1}=u_{i+1})$ 前后两个分段三次方程，则有$2(n-1)$个方程，再加上两个端点分别满足第一个和最后一个三次方程，则总共有$2n$个方程；


  其次，$n-1$个内部点的一阶导数应该是连续的，即在第 i 区间的末点和第 i+1 区间的起点是同一个点，它们的一阶导数应该也相等，即 $S'_i(x_{i+1})=S'_{i+1}(x_{i+1})$则有n-1个方程

  另外，内部点的二阶导数也要连续，即 $S''_i(x_{i+1})=S''_{i+1}(x_{i+1})$ ,也有n-1个方程

  现在总共有$4n-2$个方程了，还需要两个约束条件，可以选择首尾两点二阶导等于0，也就是自然边界条件：$y''_{0}(x_0) = y''_{n-1}(x_n)$  $i = 1,2,...,n-1$

  - 将这些参数以及约束条件整理，写成矩阵形式，经过一系列推导之后，可以得到一个左侧的系数矩阵为**严格对角占优矩阵**。即：每一行中对角元素的值的模 > 其余元素值的模之和。故线性方程组有唯一解。

  - 用追赶法解该矩阵即可求得对应的三次样条函数。

- 两个额外条件（边界条件）

  - 自由端：指定曲线再两个端点处的二阶导数值 （为0时为自然三次样条）
  - 加持端：指定曲线再两个端点处的一阶导数值
  - 其他：

- 其他方法：![](https://raw.githubusercontent.com/poinne/md-pic/main/7.png)

- 简化的计算技巧：
  - Hermite型插值多项式 ： 两点及其一阶导数（切线）
  - Lidstone型插值多项式 ： 两点及其二阶导数（曲率）
  - 好处：在给定两个端点及其倒数情况下，可直接写出函数的表达形式

- 三次参数样条曲线解法：
  - 3个坐标分量x,y,z分别时参数t的三次样条函数
  - 对型值点做参数化
  - 对3个坐标分量分别处理

- 曲线的几何连续性

  - 参数连续性
    -  $C^0:曲线在该点处连续$
    - $C^1 :f'连续$
    - $ C^2:f''连续$
    - 参数连续性过于严格，在几何设计中不太直观，且连续性依赖于参数的选择
  - 几何连续性
    - 定义：对应一条给定的曲线$f(t)$，如果存在一个参数变换$t=g(s)$，使得$f(g(s)) \in C^n$，则成曲线$f(x)$时n阶几何连续的曲线
    - 具体形式：

  <img src="https://raw.githubusercontent.com/poinne/md-pic/main/9.png" style="zoom:50%;" />

  - 即$G^0 = C^0$、 $G^1 : 切线连续 $ 、$G^2 : 曲率连续$  （注意：不要求相等）

### Bezier曲线

前提 ：$f(t) = at^2 + bt + c$ 做出的曲线与$a、b、c$三点的对应控制关系不明显

$f(t) = (1 0)^T(1-t)^2 + (0 0)^T2t(1-t) + (0 1)^Tt^2$  (Bernstein basis)，可以直观看出控制顶点与曲线的关系

- Bezier曲线：用Bernstein基函数所表达的曲线，n+1个控制顶点与基函数组合可生成n次Bezier曲线。
- Bezier曲线的性质来源于Bernstein基函数的性质

- Bernstein基函数的性质：（$B_i^{(n)}(t) = C_i^nt^i(1-t)^{n-i}$）
  - 对称性：$B_i^{(n)}(t) = B_{n-i}^{(n)}(1-t)$
  - 正权性 （正性 + 权性）-->凸包性（曲线一定在控制顶点组成的多边形内部）
    - 正性：$B_i^{(n)}(t) >=0$
    - 权性：$\sum_{i=1}^nB_i^n(t) = 1$
  - 基性：$B = \{B_0^{n},B_1^n,...,B_n^n\}$是次数不高于n的多项式几何的一组基。
  - 递推公式：高阶的基函数由2个低阶的基函数”升阶“得到。
  - 端点插值型：Bezier曲线经过首末两个顶点
  - 导数
  - 升阶 ： 两个低阶的可以组合为一个高阶的
- Bezier曲线的de Casteljau算法

<img src="https://raw.githubusercontent.com/poinne/md-pic/main/10.png" style="zoom:50%;" />

- 有理Bezier曲线 ：
  -  每个控制顶点上设置一个权系数，如权系数都相等，则退化为Bezier曲线
  - 高维Bezier曲线在某一平面的空间投影
  - 控制顶点的权系数越大，曲面就越靠近该点

### B样条曲线 

**通过一个统一的基函数去定义一个分段的曲线**

分段的多项式曲线都被称为样条

前提：

Bezier曲线具有全局性，牵一发而动全身，不利于设计，原因是基函数时全局的

性质：

- 局部性 ： 任何一阶的基函数都只在部分地方非零，其余地方都是零
- 正权性-》凸包性

B样条曲线每个控制顶点都有一个参数，B样条曲线公式如下：$x(t) = \sum_{i=0}^nN_{i,k}(t)*d_i$ , $d_i$为控制顶点。

对于一条n阶B样条曲线，每相邻n+1个顶点定义一段曲线

通过顶点的重叠可以控制控制顶点的光滑性

- 计算 ： de Boor算法

### NURBS曲线

（Non-Uniform Rational B-Spline）(非均匀有理B样条)

非均匀：节点非均匀

影响NURBS曲线建模的因素

- 控制顶点：用户交互的手段
- 节点向量：决定了B样条基函数
- 权系数：也影响曲线的形状，生成圆锥曲线等

### 细分曲线

<img src="https://raw.githubusercontent.com/poinne/md-pic/main/11.png" style="zoom:50%;" />

**逼近型细分**

- Chaiukin方法（二次B样条）

  - Chaiukin 方法是一种迭代的细分方法，每次迭代都会生成新的控制点，通过对原始曲线进行插值 来逼近原始曲线。 

  - 每个迭代步骤中，原始曲线上的每个线段都会被分割成两个子线段，其中每个子线段的端点都是 原始曲线上的控制点或插值点。

  - 迭代的次数越多，细分后的曲线越接近原始曲线。可以证明，该方法的极限情况是一条二次均匀 B 样条曲线，其拓扑规则相当于“割角”。 

  - 每次细分的算法如下：

    $v'_{2i} = \frac{1}{4}v_{i-1} + \frac{3}{4}v_i$

    $v'_{2i+1} = \frac{3}{4}v_{i} + \frac{1}{4}v_{i+1}$

  - 极限曲线为二次均匀B样条曲线、节点处$c^1$ ，其余点处$c^{\infty}$

- 均匀三次B样条细分方法

  - 均匀三次 B 样条细分方法是一种基于三次 B 样条曲线的细分方法，它使用固定的权重和基函数来生 成细分后的曲线。 

  - 细分过程中，原始曲线上的每个线段都会被分割成更多的子线段，新的控制点通过计算原始曲线 上的控制点和权重之间的线性组合得到。 

  - 均匀三次 B 样条细分方法保持了原始曲线的平滑性和几何性质，并且具有较高的逼近精度。其拓扑规 则相当于将每 条边“分裂”。 

  - 每次细分的算法如下：

    $v'_{2i} = \frac{1}{8}v_{i-1} + \frac{3}{4}v_i+\frac{1}{8}v_{i+1}$

    $v'_{2i+1} = \frac{1}{2}v_{i} + \frac{1}{2}v_{i+1}$

**插值型细分**（原来的顶点保持不变，对每条边，不断增加新的点，不断迭代，生成一条曲线）

- 4点细分法

  - 与上述逼近型细分不同，4 点细分方法在保留旧顶点的基础上，对每条边都增加了 1 个新顶点（插值）。

  - 如果将给定的几个控制点比作大石头，那么逼近型细分就行通过雕刻这个石头来得到想要的形状。而插值型细分则相当于往石头上添“泥巴”，来得到想要的形状。 

  - 其拓扑规则相当于“补角”，每次细分的算法如下：

    $v'_{2i} = v_i$

    $v'_{2i+1} = \frac{v_i+v_{i+1}}{2} + \alpha(\frac{v_i+v_{i+1}}{2} - \frac{v_i+v_{i+2}}{2})$

### 隐式曲线

- 隐式函数 ： 自变量x和应变量y的关系非显式关系，是一个隐式的关系（代数方程） $f(x,y) = 0$

<img src="https://raw.githubusercontent.com/poinne/md-pic/main/12.png" style="zoom:50%;" />

- 隐式曲线的绘制：

  - Marching Cubes算法 （隐式曲线绘制的最常用方法）？？应该是Marching Squares算法

  <img src="https://raw.githubusercontent.com/poinne/md-pic/main/13.png" style="zoom:50%;" />

- 隐式曲线的拟合

  - 问题 ：
    - 输入：平面上的一些点（无序）（一般还需要给定或估计点的法向信息）
    - 输出：拟合这些点的一个隐式函数（该隐式函数表达的曲线就是拟合曲线）

### NURBS曲面

- 基本方法 ： 张量积

​		用两个张量积函数组合为张量积曲面 ： 曲线的曲线

- 张量积曲面
  - 两个独立方向的“曲线”的“曲线”
  - 性质大都类同于曲线的性质
  - 表达、公式形式比曲线情形复杂
  - 特殊问题：角点的光滑性

### 曲线光顺 （Curve fairing）

<img src="https://raw.githubusercontent.com/poinne/md-pic/main/15.png" style="zoom:50%;" />

- 定义

  - 光顺是微观的角度看的

  - 光顺曲线的曲率图不发生大的变化

  - 曲线光顺通常指的是在计算机图形学和几何建模中，使曲线的外观更加平滑和自然的过程。光顺的曲线通常不会显示锯齿状的边缘或不连续的变化，而是呈现出连续、流畅和自然的形状

- B样条曲线的光顺方法
  - 基于稀疏优化的光顺优化方法 
- 曲面的光顺
  - 方法1：三向曲线光顺
  - 方法2：能量法

### 离散曲线

- 曲线建模的两个观点
  - Fitting（Reconstruction）【也叫回归】
    - 从代数观点：需要函数空间表达能力足够
    - 输入：采样点{$S_j,j=0 -- m$}及基函数{$b_i(t),i=0--n$}
    - 输出：拟合函数的稀疏{$p_i,i=0--n$}
  - Design
    - 从几何观点：具有好性质的基函数使得交互设计更直观
    - 输入：交互输入（或者反求）控制顶点{$p_i,i=0--n$}
    - 输出：曲线$f(t)$

- 曲线的不同表达方法
  - 显式函数曲线
  - 参数曲线
  - 隐式曲线
  - 细分曲线

- 曲线的离散化
  - 将连续性表达转换为多边形表达（分段线性）

- 离散曲线的几何量的计算
  - 如果由连续表达，利用连续表达的曲线来计算
  - 如无连续表达
    - 差分法：利用差分形式来近似微分属性
    - 拟合法：利用光滑函数来拟合估计属性
    - Tylor展开及估计

<img src="https://raw.githubusercontent.com/poinne/md-pic/main/16.png" style="zoom:80%;" />

- Free-form Deformation(FFD)
  - 通过操作一个复杂几何体的几个有限的控制顶点来操作几何体（代理顶点）
- 流形：任一顶点的无穷小领域可以拓扑为一个小圆盘

- 半边（half-edge）数据结构
  - 半边结构：以“边”为中心的数据结构
  - 网格链接关系存储在边上，每条边表达为两条“半边”
  - 目的：提高点线面的查询或增删改操作的效率
  - 将一条无向边  -> 两条方向相反的有向边
  - **目前使用的半边数据机构只适用于流形网格**
  - [文章](https://zhuanlan.zhihu.com/p/39645375) 、 [视频](https://www.bilibili.com/video/BV18M4y147za/?spm_id_from=333.337.search-card.all.click&vd_source=fa01bbb0bfe8eb4919bc52e6f75d6c5a)

- 几何（网格）处理库
  - CGAL、Libigl、MeshLab、OpenMesh、PCL、TriMesh、DGtal

### 曲面微分几何

- Cureve

  <img src="https://raw.githubusercontent.com/poinne/md-pic/main/17.png" style="zoom:50%;" />

- 曲率 （二阶密切圆半径的倒数），刻画了曲线本征的不变量
- 曲率与参数化无关
- 曲线的曲率确定，该曲线也确定
- 曲面的曲率都是带方向的

- Surface（曲面）

  - 曲面任一点的切线不止一条，是一个切平面，任一点的法向是两个偏导的叉积，在某一方向的曲线与法向的交线所构成的曲率，定义为该方向的曲率（曲面的曲率有方向）

    <img src="https://raw.githubusercontent.com/poinne/md-pic/main/19.png" style="zoom:50%;" />

  - $S_v$ 、 $S_u$为p点处的两条不同方向的切线  $N$为法向。
  - 可以证明：在一点处所有的曲率中，有两个方向的曲率分别是最大和最小的$k_1,k_2$，且这两个方向相互正交（垂直），称为主曲率。
  - 其他方向曲率是这两个主曲率的线性组合$k = k_1cos^2\Theta +k_2sin^2\Theta$。
  - 平均曲率 $k = \frac{k_1+k_2}{2}$，处处平均曲率为0的曲面为极小曲面
  - 高斯曲率 ： 两个主曲率相乘 $k = k_1k_2$， 等距变换不变量，处处高斯曲率为0的曲面为可展曲面。

- 如何求三角网格给定点的法向量？

  - 用给定点以及周围的点拟合出一个光滑的抛物面，求抛物面的法向量
  - 用离散的方法去找法向量

- 离散平均曲率流 ： 
  - $P_{new}\leftarrow P_{old} + \lambda H(P_{old})n(P_{old})$
  - 一个“开曲面”，先求出顶点的1-邻域的点的重心坐标，然后将顶点沿着顶点与重心连线的方向移动$\alpha$

##### 局部迭代法求解最小曲面（所用曲面为带一条边界的曲面）

###### 步骤：

- 找到边界

- 固定边界顶点，每次迭代后边界的顶点都保持固定，只有内部的顶点发生变化（平均曲率逐步趋近于0）

- 对每个内部顶点：找顶点1-邻域（与该顶点相邻的所有顶点），通过
  $$
  (x_{avg},a_{avg},z_{avg})=\frac{1}{n}\sum^n_{i=1}{(x_i,y_i,z_i)}
  $$
  计算它们的平均坐标,然后通过
  $$
  (x_{new},y_{new},z_{new})=\alpha(x_{old},y_{old},z_{old})+(1-\alpha)(x_{avg},y_{avg},z_{avg})
  $$
  计算加权平均值。α 的值通常在0.5到1之间。如果 α 的值接近1，则新坐标更接近原始坐标；如果 α 的值接近0，则新坐标更接近平均坐标。

- 迭代

- 更新所有顶点法向，在极小曲面算法中，更新所有顶点法向是为了保证每个顶点的法向都指向曲面内部。这是因为在迭代过程中，曲面会不断收缩，如果不更新顶点法向，则会导致曲面内部的顶点法向指向曲面外部，从而导致算法无法收敛。

  - 具体做法为：
    - 对于每个顶点，计算其相邻面的法向量的平均值。
    - 将计算得到的平均法向量赋值给该顶点。

##### 全局法求解给定曲面的极小曲面

全局法的思想就是解方程，求解Ax=b。 每个非边界点的位置设都是未知量，每个边界点
的位置都是已知量， 由极小曲面的限制条件来构成方程。 每个点的 x，y，z 三个
分量可以用同样的方法分别求解。

- 建立系数矩阵A（构建Laplace矩阵）

  - 记曲面共有的点数目 为 m，不妨把曲面中的所有点表示为 $r_1,r_2,...,r_m$
    建立一个 m 阶方阵 A （Laplace矩阵）来记录方程的系数。建立方法如下：
    首先设 A 的所有元为 0。

  - 对于点 $r_i$， 如果$r_i$为边界点，则将$A(i,i)$ 改为 1； 如果$r_i$不是边界点， 则检
    测$r_i$的相临点，记临点数为n，记n个临点分别为为$r_{k_1},r_{k_2},...,r_{k_n}$，对于$1\leqslant i \leqslant n$，
    更改$A(i,k_j)$为$cot$权， 更改$A(i,i)$为 $-w_{i,j}$.即：

    $L_{i,j}=\left\{ \begin{array}{rcl} 1,  & i=j \\ -w_{i,j}, & j\in N_1(i) \\ 0, & other \end{array}\right.$

    其中$j\in N_1(i)指点v_i的1邻域内，-w_{i,j}是v_i和v_j的cot权：$

    $w_{i,j}=\frac{cot\alpha_{i,j}+cot\beta_{i,j}}{\sum_{k\in N_1(i)}{cot\alpha_{i,k}+cot\beta_{i,k}}},j\in N_1(i)$

对于$1\leqslant i \leqslant m$， 进行上述步骤。

- 建立常数向量b（起约束作用）
  - 建立 conX, conY, conZ三个$m\times1$列向量， 构成线性方程组的常数阵。 建立方
    法如下： 建立 X, Y, Z三个$m\times1$列向量， 记录待解点的三个坐标（依次为x、y、z）。
    首先设 conX, conY, conZ的值为 0（即零向量）。
    对于点$r_i$,如果$r_i$为边界点， 则将$conX(i)$改为$r_i$的 x坐标， 将$conY(i)$改为$r_i$的
    y 坐标，将$conZ(i)$改为$r_i$的 z 坐标（目的是约束边界点，使边界点固定）； 如果$r_i$不是边界点， 令 $conX(i)=conY(i)=conZ(i)=0$.

对于$1\leqslant i\leqslant m$， 进行上述步骤。

- 解方程

分别解三个方程：
$A*X=conX;$

$A*Y=conY;$

$A*Z=conZ;$

即解： $A*x=b$，得到 X, Y, Z 三个列向量的解.

- 更新坐标
  - 对于$1\leqslant i\leqslant m$， 令 $r_i=(conX(i), conY(i), conZ(i))$   , 即完成点坐标的更新

- 需要注意的点

  - 一般情况下所给曲面顶点数都较多，可能有上万个，设顶点数为n，构建n*n的方阵A时，实际上每行的长度为n的行向量只有几个位置元素值不为零（小于10个），其余位置都为零，所以矩阵A是一个非常稀疏的矩阵，所以在构建时可以使用所用数学库提供的稀疏矩阵来创建。

  - 构建矩阵A时需要区分边界点与非边界点的取值。


#### 曲面参数化方法

上述原理类似，仅仅在约束边界时不同，将边界映射到圆周或矩形四边上，全局化方法构造Laplace矩阵时需要保持边界点不变，即跳过边界点，具体做法为：

- 先求出边界点的参数化坐标。得到排好序的边界，然后根据边界的周长把边界分为四段。
  四段的四个端点设为$(0,0),(1,0),(1,1),(0,1)$，段内点的坐标根据长度进行插值得到。
- 然后使用与上述一样的方法构造线性方程组$Lv=0$，只是求解得到的v为参数化坐标，此时不使用第三个维度的信息。
- 参数化后的曲面形状不同，约束条件也不同
- 其余步骤同全局化方法求极小曲面

### 曲面去噪、采样与剖分

- 由于设备、测量一起误差等，会出现扰动，叫做噪声 ，去噪过程叫做 Mesh(surface) Denising

- $Input:M$(含噪声的网格曲面) $Output:M^0$（无噪声的网格曲面）

- $M = M^0 + \epsilon \rightarrow v = v^0 + \epsilon \times n$ （for all 属于M) (对曲面去噪 -> 找曲面上每个顶点的位置，n为改顶点的法向,$v^0$为正确位置，$\epsilon$为噪声或扰动，v为现在的位置)

- $v = v^0 + \epsilon \times n  \rightarrow v^0 = v - \epsilon \times  n$,然后不断迭代，使v 趋近于$v^0$

- Filtering 

  - 几何意义：将函数h(t)作为权来对x(t)进行加权平均（滤波）

  - 将x(t)的局部信息进行混合平均

  - 数学是一个符号系统

  - 一般使用Gauss函数作为权函数

    <img src="https://raw.githubusercontent.com/poinne/md-pic/main/20.png" style="zoom:50%;" />

  - 滤波对象 : Vertex、 Normal、  Curvature 、 Color .....

  - 影响因素 : Iteration number 、Shrinkage 

- 图5 双边滤波 ， 为了保特征，下边的是为了归一化，使值为1

<img src="https://raw.githubusercontent.com/poinne/md-pic/main/21.png" style="zoom:50%;" />

- Normal Filtering

  - 先对法向进行滤波：可使用顶点滤波的任何方法，然后根据滤波后的法向重建网格顶点(根据法向反求顶点)

- Sampling

  - 从连续到离散  连续信号 通过采样 得到离散采样   离散采样 通过重建（拟合）得到 连续信号

- 两个剖分方法： Voronoi 、Delaunay
  - Voronoi图与Delaunay图 是对偶关系

- Delaunay T..     DT  性质

  - Empty sphere property （任意三个相邻点围成的三角形所组成的圆不会包含其它顶点）
  - maximaizes thre smallest angle(最小角最大化)[最小角是所有可能的三角形中最大的]
  - 凸包性

  - ...

  - 曲面的一小部分与离散改部分所得到的三角形平面之间的体积最小

  - 对应的Laplacian 对应的特征根是最大的

- Simple Method : 
  - 寻找两个相邻三角形，看是不是合适的三角形（即翻转后的公共线能否使新得到的两个三角形的最小角变大）、迭代至收敛      [效率低]   **CGAL库**
- Centroidal Voronoi Tessellation (CVT)  采样点和重心两点重合，特征分布均匀
- 如何由普通VT图求CVT ： 
  - 用曲线光顺的方法，将顶点不断向重心靠近（Lloyd Algorithm）

  - 当顶点与所处区域的重心重合时，就是CVT图

- Triangle 库 http://www.cs.cmu.edu/~quake/triangle.html
- 自适应采样 、 四边形网格化、空间体的采样与剖分 （表面是三角形，内部是四面体或六面体）
- TRTGEN https://people.sc.fsu.edu/~jburkardt/examples/tetgen/tetgen.html

- 构建Laplace矩阵时添加顶点约束

<img src="https://raw.githubusercontent.com/poinne/md-pic/main/22.png" style="zoom:50%;" />